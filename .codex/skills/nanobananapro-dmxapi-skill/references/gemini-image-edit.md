Gemini å›¾ç‰‡ç¼–è¾‘ API æ¥å£æ–‡æ¡£
ä½¿ç”¨ Geminiï¼ˆåˆç§° Nano Banana ğŸŒï¼‰æ¨¡å‹è¿›è¡Œæ™ºèƒ½å›¾ç‰‡ç¼–è¾‘

æ¥å£åœ°å€
æ¥å£åœ°å€ä¸­çš„æ¨¡å‹åç§°æ ¹æ®éœ€è¦æ›¿æ¢ã€‚

https://www.dmxapi.cn/v1beta/models/gemini-3-pro-image-preview:generateContent
æ³¨æ„ï¼š

éœ€è¦å‡çº§è°·æ­Œsdkä¸ºæœ€æ–°ç‰ˆ

æ¨¡å‹åç§°
æ¨¡å‹åç§° è¯´æ˜
gemini-3-pro-image-preview æ”¯æŒ 1K/2K/4K åˆ†è¾¨ç‡çš„é«˜çº§å›¾åƒç¼–è¾‘æ¨¡å‹
gemini-2.5-flash-image æ”¯æŒ 1K åˆ†è¾¨ç‡çš„å¿«é€Ÿå›¾åƒç¼–è¾‘æ¨¡å‹
Python SDK ä»£ç ç¤ºä¾‹
ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ DMXAPI è°ƒç”¨ Gemini æ¨¡å‹è¿›è¡Œå›¾ç‰‡ç¼–è¾‘ï¼š

"""
DMXAPI Gemini å›¾åƒä¿®æ”¹ç¤ºä¾‹
ä½¿ç”¨ Google Gemini API ä¿®æ”¹å›¾åƒï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ° output æ–‡ä»¶å¤¹
"""

from google import genai
from google.genai import types
from PIL import Image
import os
from datetime import datetime

# ============================================================================

# é…ç½®éƒ¨åˆ†

# ============================================================================

# DMXAPI å¯†é’¥å’ŒåŸºç¡€ URL

api_key = "sk-********************\*\*\*********************" # æ›¿æ¢ä¸ºä½ çš„ DMXAPI å¯†é’¥
BASE_URL = "https://www.dmxapi.cn"

# è¾“å…¥å›¾åƒè·¯å¾„

INPUT_IMAGE_PATH = "test/example.jpg" # æ›¿æ¢ä¸ºä½ è¦ä¿®æ”¹çš„å›¾ç‰‡è·¯å¾„

# åˆ›å»º Gemini å®¢æˆ·ç«¯

client = genai.Client(api_key=api_key, http_options={'base_url': BASE_URL})

# ============================================================================

# å›¾åƒä¿®æ”¹æç¤ºè¯

# ============================================================================

# è¯»å–è¦ä¿®æ”¹çš„å›¾åƒ

image = Image.open(INPUT_IMAGE_PATH)

# å®šä¹‰å›¾åƒä¿®æ”¹çš„æç¤ºè¯

prompt = (
"è®©è¿™ä¸ªè®¡ç®—å™¨åƒè¥¿ç“œ"
)

# ============================================================================

# è°ƒç”¨ DMXAPI ä¿®æ”¹å›¾åƒ

# ============================================================================

response = client.models.generate_content( # æ¨¡å‹åç§°
model="gemini-3-pro-image-preview", # ä½¿ç”¨ Gemini 2.5 Flash å›¾åƒæ¨¡å‹

    # è¾“å…¥å†…å®¹ï¼šæç¤ºè¯ + åŸå§‹å›¾åƒ
    contents=[prompt, image],

    # ç”Ÿæˆé…ç½®
    config=types.GenerateContentConfig(
        # response_modalities: è®¾ç½®å“åº”æ¨¡æ€
        # - ['Image']: ä»…è¿”å›å›¾ç‰‡ï¼Œä¸è¿”å›æ–‡æœ¬
        # - ['Text', 'Image']: åŒæ—¶è¿”å›æ–‡æœ¬å’Œå›¾ç‰‡ï¼ˆé»˜è®¤å€¼ï¼‰
        # gemini-2.5-flash-image ä¸èƒ½ä½¿ç”¨è¯¥å‚æ•°
        response_modalities=['Image'],

        # image_config: å›¾åƒé…ç½®é€‰é¡¹
        image_config=types.ImageConfig(
            # aspect_ratio: è®¾ç½®è¾“å‡ºå›¾ç‰‡çš„å®½é«˜æ¯”ï¼ˆæ³¨æ„ï¼šä½¿ç”¨é©¼å³°å‘½åï¼‰
            #
            # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            # â”‚ Gemini 2.5 Flash                                                â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
            # â”‚ å®½é«˜æ¯”    â”‚ åˆ†è¾¨ç‡      â”‚ ä»¤ç‰Œ    â”‚                               â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
            # â”‚ 1:1      â”‚ 1024x1024   â”‚ 1290   â”‚                               â”‚
            # â”‚ 2:3      â”‚ 832x1248    â”‚ 1290   â”‚                               â”‚
            # â”‚ 3:2      â”‚ 1248x832    â”‚ 1290   â”‚                               â”‚
            # â”‚ 3:4      â”‚ 864x1184    â”‚ 1290   â”‚                               â”‚
            # â”‚ 4:3      â”‚ 1184x864    â”‚ 1290   â”‚                               â”‚
            # â”‚ 4:5      â”‚ 896x1152    â”‚ 1290   â”‚                               â”‚
            # â”‚ 5:4      â”‚ 1152x896    â”‚ 1290   â”‚                               â”‚
            # â”‚ 9:16     â”‚ 768x1344    â”‚ 1290   â”‚                               â”‚
            # â”‚ 16:9     â”‚ 1344x768    â”‚ 1290   â”‚                               â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            #
            # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            # â”‚ Gemini 3 Pro Image é¢„è§ˆç‰ˆ                                        â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
            # â”‚ å®½é«˜æ¯”    â”‚ 1K åˆ†è¾¨ç‡   â”‚ 1Kä»¤ç‰Œ  â”‚ 2K åˆ†è¾¨ç‡   â”‚ 4K åˆ†è¾¨ç‡      â”‚â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
            # â”‚ 1:1      â”‚ 1024x1024   â”‚ 1210   â”‚ 2048x2048   â”‚ 4096x4096     â”‚â”‚
            # â”‚ 2:3      â”‚ 848x1264    â”‚ 1210   â”‚ 1696x2528   â”‚ 3392x5056     â”‚â”‚
            # â”‚ 3:2      â”‚ 1264x848    â”‚ 1210   â”‚ 2528x1696   â”‚ 5056x3392     â”‚â”‚
            # â”‚ 3:4      â”‚ 896x1200    â”‚ 1210   â”‚ 1792x2400   â”‚ 3584x4800     â”‚â”‚
            # â”‚ 4:3      â”‚ 1200x896    â”‚ 1210   â”‚ 2400x1792   â”‚ 4800x3584     â”‚â”‚
            # â”‚ 4:5      â”‚ 928x1152    â”‚ 1210   â”‚ 1856x2304   â”‚ 3712x4608     â”‚â”‚
            # â”‚ 5:4      â”‚ 1152x928    â”‚ 1210   â”‚ 2304x1856   â”‚ 4608x3712     â”‚â”‚
            # â”‚ 9:16     â”‚ 768x1376    â”‚ 1210   â”‚ 1536x2752   â”‚ 3072x5504     â”‚â”‚
            # â”‚ 16:9     â”‚ 1376x768    â”‚ 1210   â”‚ 2752x1536   â”‚ 5504x3072     â”‚â”‚
            # â”‚ 21:9     â”‚ 1584x672    â”‚ 1210   â”‚ 3168x1344   â”‚ 6336x2688     â”‚â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            # â”‚ æ³¨: 2K/4K åˆ†è¾¨ç‡ä»¤ç‰Œåˆ†åˆ«ä¸º 1210/2000                             â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            #
            aspect_ratio="16:9",

            # image_size: è®¾ç½®è¾“å‡ºå›¾ç‰‡çš„åˆ†è¾¨ç‡
            # - "1K": 1K åˆ†è¾¨ç‡ï¼ˆé»˜è®¤å€¼ï¼Œæ‰€æœ‰æ¨¡å‹å‡æ”¯æŒï¼‰
            # - "2K": 2K åˆ†è¾¨ç‡ï¼ˆä»… Gemini 3 Pro Image é¢„è§ˆç‰ˆæ”¯æŒï¼‰
            # - "4K": 4K åˆ†è¾¨ç‡ï¼ˆä»… Gemini 3 Pro Image é¢„è§ˆç‰ˆæ”¯æŒï¼‰
            # gemini-2.5-flash-image ä¸èƒ½ä½¿ç”¨è¯¥å‚æ•°
            # image_size="4K",
        ),

        # tools: Google æœç´¢å·¥å…·ï¼ˆå¯é€‰ï¼‰
        # - ä½¿ç”¨å®æ—¶ä¿¡æ¯ä¿®æ”¹å›¾åƒï¼ˆå¦‚æ ¹æ®æœ€æ–°èµ„è®¯æ·»åŠ å…ƒç´ ç­‰ï¼‰
        # - æ³¨æ„: ä½¿ç”¨æœç´¢å·¥å…·æ—¶å¿…é¡»è®¾ç½® response_modalities=['Text', 'Image']
        # - å›¾ç‰‡ä¸“ç”¨æ¨¡å¼ ['Image'] ä¸æœç´¢å·¥å…·ä¸å…¼å®¹
        # ç¤ºä¾‹: tools=[{"google_search": {}}]
        # gemini-2.5-flash-image ä¸èƒ½ä½¿ç”¨è¯¥å‚æ•°
        # tools=[{"google_search": {}}]
    )

)

# ============================================================================

# å¤„ç†å“åº”å¹¶ä¿å­˜ä¿®æ”¹åçš„å›¾åƒ

# ============================================================================

for part in response.parts: # å¤„ç†æ–‡æœ¬å“åº”ï¼ˆå¦‚æœæœ‰ï¼‰
if part.text is not None:
print(part.text)

    # å¤„ç†å›¾åƒå“åº”
    elif part.inline_data is not None:
        # ç¡®ä¿ output æ–‡ä»¶å¤¹å­˜åœ¨
        os.makedirs("output", exist_ok=True)

        # ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶å
        # æ ¼å¼: edited_image_20250121_143052.png (å¹´æœˆæ—¥_æ—¶åˆ†ç§’)
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"output/edited_image_{timestamp}.png"

        # å°†å“åº”æ•°æ®è½¬æ¢ä¸º PIL Image å¯¹è±¡
        image = part.as_image()

        # ä¿å­˜å›¾åƒåˆ°æ–‡ä»¶
        image.save(filename)

        # è¾“å‡ºä¿å­˜æˆåŠŸçš„æç¤ºä¿¡æ¯
        print(f"ä¿®æ”¹åçš„å›¾ç‰‡å·²ä¿å­˜åˆ° {filename}")

è¿è¡Œç»“æœ
æ‰§è¡Œä¸Šè¿°ä»£ç åï¼Œä½ å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

**Visualizing a Calculator**

I'm currently picturing a calculator, specifically a Canon WS-1212H model, as a cartoon character. I'm focusing on giving it a face and limbs. The primary action is having it enjoy a watermelon. I'm working out the best way to incorporate the watermelon into the design, perhaps using the calculator's display as the mouth.

**Designing the Scene**

I've decided on the scene: the calculator is holding the watermelon. I'm focusing on the details of the watermelon itself â€“ the red flesh, the black seeds. I'm imagining juice and rind around the calculator's mouth. I'm considering how to arrange the discarded rinds and seeds in the scene. The original blue wave background will be kept.

**Visualizing the Concept**

I'm currently focused on the anthropomorphic aspects, specifically how to best represent a calculator enjoying watermelon. The details of the watermelon itself, from the juice to the rind, are areas I'm carefully considering for the most impactful visual representation.

**Evaluating the Results**

I've reviewed the output and focused on the anthropomorphic elements. The successful cartoonization of the calculator, combined with the action and details, aligns with the specified goals. The depiction of the watermelon and the calculator's expression are noteworthy.

ä¿®æ”¹åçš„å›¾ç‰‡å·²ä¿å­˜åˆ° output/edited_image_20251121_182350.png
Python request ä»£ç ç¤ºä¾‹

# """

# Gemini å›¾æ–‡ç”Ÿå›¾ç¤ºä¾‹

åŠŸèƒ½è¯´æ˜ï¼š
ä½¿ç”¨ Google Gemini API çš„æ¥å£ï¼Œæ ¹æ®æ–‡å­—æç¤ºè¯å’Œè¾“å…¥å›¾ç‰‡ç”Ÿæˆæ–°å›¾ç‰‡ã€‚
æ”¯æŒè°ƒæ•´è¾“å‡ºå›¾ç‰‡çš„æ¯”ä¾‹ã€å¤§å°ï¼Œä»¥åŠè°ƒç”¨è°·æ­Œæœç´¢å·¥å…·ã€‚
================================================================
"""
import requests
import base64
import os
from datetime import datetime

# ========================================

# API é…ç½®ä¿¡æ¯

# ========================================

# ä½ çš„ DMXAPI å¯†é’¥ï¼ˆè¯·æ›¿æ¢ä¸ºçœŸå®å¯†é’¥ï¼‰

API_KEY = "sk-**************\*\*\*\***************"

# DMXAPI è¯·æ±‚åœ°å€

BASE_URL = "https://www.dmxapi.cn/v1beta"

# ========================================

# å›¾ç‰‡é…ç½®

# ========================================

# è¾“å…¥å›¾ç‰‡è·¯å¾„

INPUT_IMAGE_PATH = "gemini-native-image.png"

# ========================================

# å›¾ç‰‡ç¼–ç å‡½æ•°

# ========================================

def encode_image_to_base64(image_path: str) -> tuple[str, str]:
"""è¯»å–å›¾ç‰‡æ–‡ä»¶å¹¶è½¬æ¢ä¸º base64 ç¼–ç """
ext = os.path.splitext(image_path)[1].lower()
mime_types = {
'.jpg': 'image/jpeg',
'.jpeg': 'image/jpeg',
'.png': 'image/png',
'.gif': 'image/gif',
'.webp': 'image/webp',
}
mime_type = mime_types.get(ext, 'image/jpeg')

    with open(image_path, 'rb') as f:
        image_data = f.read()

    return base64.b64encode(image_data).decode('utf-8'), mime_type

# ========================================

# æ„å»ºè¯·æ±‚å¤´

# ========================================

headers = {
"Content-Type": "application/json",
"x-goog-api-key": API_KEY,
}

# ========================================

# æ„å»ºè¯·æ±‚ä½“

# ========================================

# ç¼–ç å›¾ç‰‡ä¸º base64

img_base64, mime_type = encode_image_to_base64(INPUT_IMAGE_PATH)

payload = {
"model": "gemini-3-pro-image-preview", # æŒ‡å®šä½¿ç”¨çš„ AI æ¨¡å‹
"contents": [{
"parts": [
{"text": "åœ¨å›¾åƒä¸­åŠ å…¥æ¢µé«˜çš„è‡ªç”»åƒ"},
{
"inline_data": {
"mime_type": mime_type,
"data": img_base64
}
}
]
}],
"generationConfig": { # responseModalities: è®¾ç½®å“åº”æ¨¡æ€ # - ['IMAGE']: ä»…è¿”å›å›¾ç‰‡ï¼Œä¸è¿”å›æ–‡æœ¬ # - ['TEXT', 'IMAGE']: åŒæ—¶è¿”å›æ–‡æœ¬å’Œå›¾ç‰‡ï¼ˆé»˜è®¤å€¼ï¼‰
"responseModalities": ["IMAGE"],

        # imageConfig: å›¾åƒé…ç½®é€‰é¡¹
        "imageConfig": {
            # aspectRatio: è®¾ç½®è¾“å‡ºå›¾ç‰‡çš„å®½é«˜æ¯”
            #
            # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            # â”‚ Gemini 2.5 Flash                                                â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
            # â”‚ å®½é«˜æ¯”    â”‚ åˆ†è¾¨ç‡      â”‚ ä»¤ç‰Œ    â”‚                               â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
            # â”‚ 1:1      â”‚ 1024x1024   â”‚ 1290   â”‚                               â”‚
            # â”‚ 2:3      â”‚ 832x1248    â”‚ 1290   â”‚                               â”‚
            # â”‚ 3:2      â”‚ 1248x832    â”‚ 1290   â”‚                               â”‚
            # â”‚ 3:4      â”‚ 864x1184    â”‚ 1290   â”‚                               â”‚
            # â”‚ 4:3      â”‚ 1184x864    â”‚ 1290   â”‚                               â”‚
            # â”‚ 4:5      â”‚ 896x1152    â”‚ 1290   â”‚                               â”‚
            # â”‚ 5:4      â”‚ 1152x896    â”‚ 1290   â”‚                               â”‚
            # â”‚ 9:16     â”‚ 768x1344    â”‚ 1290   â”‚                               â”‚
            # â”‚ 16:9     â”‚ 1344x768    â”‚ 1290   â”‚                               â”‚
            # â”‚ 21:9     â”‚ 1536x672    â”‚ 1290   â”‚                               â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            #
            # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            # â”‚ Gemini 3 Pro Image é¢„è§ˆç‰ˆ                                        â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
            # â”‚ å®½é«˜æ¯”    â”‚ 1K åˆ†è¾¨ç‡   â”‚ 1Kä»¤ç‰Œ  â”‚ 2K åˆ†è¾¨ç‡   â”‚ 4K åˆ†è¾¨ç‡      â”‚â”‚
            # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
            # â”‚ 1:1      â”‚ 1024x1024   â”‚ 1210   â”‚ 2048x2048   â”‚ 4096x4096     â”‚â”‚
            # â”‚ 2:3      â”‚ 848x1264    â”‚ 1210   â”‚ 1696x2528   â”‚ 3392x5056     â”‚â”‚
            # â”‚ 3:2      â”‚ 1264x848    â”‚ 1210   â”‚ 2528x1696   â”‚ 5056x3392     â”‚â”‚
            # â”‚ 3:4      â”‚ 896x1200    â”‚ 1210   â”‚ 1792x2400   â”‚ 3584x4800     â”‚â”‚
            # â”‚ 4:3      â”‚ 1200x896    â”‚ 1210   â”‚ 2400x1792   â”‚ 4800x3584     â”‚â”‚
            # â”‚ 4:5      â”‚ 928x1152    â”‚ 1210   â”‚ 1856x2304   â”‚ 3712x4608     â”‚â”‚
            # â”‚ 5:4      â”‚ 1152x928    â”‚ 1210   â”‚ 2304x1856   â”‚ 4608x3712     â”‚â”‚
            # â”‚ 9:16     â”‚ 768x1376    â”‚ 1210   â”‚ 1536x2752   â”‚ 3072x5504     â”‚â”‚
            # â”‚ 16:9     â”‚ 1376x768    â”‚ 1210   â”‚ 2752x1536   â”‚ 5504x3072     â”‚â”‚
            # â”‚ 21:9     â”‚ 1584x672    â”‚ 1210   â”‚ 3168x1344   â”‚ 6336x2688     â”‚â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            # â”‚ æ³¨: 2K/4K åˆ†è¾¨ç‡ä»¤ç‰Œåˆ†åˆ«ä¸º 1210/2000                             â”‚
            # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            "aspectRatio": "1:1",

            # imageSize: è®¾ç½®è¾“å‡ºå›¾ç‰‡çš„åˆ†è¾¨ç‡
            # - "1K": 1K åˆ†è¾¨ç‡ï¼ˆé»˜è®¤å€¼ï¼Œæ‰€æœ‰æ¨¡å‹å‡æ”¯æŒï¼‰
            # - "2K": 2K åˆ†è¾¨ç‡ï¼ˆä»… Gemini 3 Pro Image é¢„è§ˆç‰ˆæ”¯æŒï¼‰
            # - "4K": 4K åˆ†è¾¨ç‡ï¼ˆä»… Gemini 3 Pro Image é¢„è§ˆç‰ˆæ”¯æŒï¼‰
            # æ³¨æ„: gemini-2.5-flash-image ä»…æ”¯æŒ 1Kï¼Œå¦‚éœ€ 2K/4K è¯·ä½¿ç”¨ gemini-3-pro-image-preview
            # "imageSize": "1K"
        }
    },

    # tools: Google æœç´¢å·¥å…·ï¼ˆå¯é€‰ï¼‰
    # - ä½¿ç”¨å®æ—¶ä¿¡æ¯ç”Ÿæˆå›¾åƒï¼ˆå¦‚æ ¹æ®æœ€æ–°èµ„è®¯æ·»åŠ å…ƒç´ ç­‰ï¼‰
    # - æ³¨æ„: ä½¿ç”¨æœç´¢å·¥å…·æ—¶å¿…é¡»è®¾ç½® responseModalities: ['TEXT', 'IMAGE']
    # - å›¾ç‰‡ä¸“ç”¨æ¨¡å¼ ['IMAGE'] ä¸æœç´¢å·¥å…·ä¸å…¼å®¹
    # "tools": [{"google_search": {}}]

}

# å®Œæ•´çš„ API ç«¯ç‚¹

API_URL = f"{BASE_URL}/models/{payload['model']}:generateContent"

# ========================================

# å‘é€ API è¯·æ±‚å¹¶å¤„ç†å“åº”

# ========================================

try: # å‘é€ POST è¯·æ±‚åˆ° API æœåŠ¡å™¨
response = requests.post(API_URL, headers=headers, json=payload, timeout=(30, 300))

    # æ£€æŸ¥ HTTP å“åº”çŠ¶æ€ç 
    response.raise_for_status()

    # ========================================
    # è¾“å‡ºæˆåŠŸç»“æœ
    # ========================================
    print("è¯·æ±‚æˆåŠŸ!")
    print("=" * 60)

    result = response.json()
    image_saved = False

    for candidate in result.get("candidates", []):
        for part in candidate.get("content", {}).get("parts", []):
            if "text" in part:
                print(f"æ–‡æœ¬å“åº”: {part['text']}")
            elif "inlineData" in part:
                image_data = part["inlineData"].get("data", "")
                if image_data:
                    os.makedirs("output", exist_ok=True)
                    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                    filename = f"output/gemini-edited-image_{timestamp}.png"

                    with open(filename, 'wb') as f:
                        f.write(base64.b64decode(image_data))

                    print(f"å›¾ç‰‡å·²ä¿å­˜åˆ°: {filename}")
                    image_saved = True

    if not image_saved:
        print("å“åº”ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ•°æ®")

except requests.exceptions.RequestException as e:
print(f"è¯·æ±‚å¤±è´¥: {e}")
except ValueError as e:
print(f"æ•°æ®è§£æé”™è¯¯: {e}")
è¿è¡Œç»“æœ

# è¯·æ±‚æˆåŠŸ!

å›¾ç‰‡å·²ä¿å­˜åˆ°: output/gemini-edited-image_20251208_222523.png
æ³¨æ„äº‹é¡¹
API å¯†é’¥ï¼šè¯·å°†ä»£ç ä¸­çš„ api_key æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ DMXAPI å¯†é’¥
å›¾ç‰‡è·¯å¾„ï¼šç¡®ä¿ INPUT_IMAGE_PATH æŒ‡å‘çš„å›¾ç‰‡æ–‡ä»¶å­˜åœ¨
åˆ†è¾¨ç‡é™åˆ¶ï¼š
gemini-2.5-flash-image ä»…æ”¯æŒ 1K åˆ†è¾¨ç‡
gemini-3-pro-image-preview æ”¯æŒ 1K/2K/4K åˆ†è¾¨ç‡
æœç´¢å·¥å…·é™åˆ¶ï¼šä½¿ç”¨ Google æœç´¢å·¥å…·æ—¶å¿…é¡»è®¾ç½® response_modalities=['Text', 'Image']
